(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[301],{43726:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Cart",function(){return t(72200)}])},72200:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var a=t(85893),r=t(67294),o=t(87066),c=t(11163),i=t(11222),n=t(35234),d=t(59103),l=t(99603),u=t(59417);t(80317),t(72422),t(44173),t(29616),t(33605);var m=e=>{let{coupon:s,discount:t,onClose:o}=e,[c,i]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{i(!0)},[]),(0,a.jsx)("div",{className:"applied-coupon-card ".concat(c?"show":""),children:(0,a.jsxs)("div",{className:"applied-coupon-content",children:[(0,a.jsx)("div",{className:"coupon-cart-img",children:(0,a.jsx)("img",{src:"/Coupon.png",alt:"Celebration",className:"celebration-icon"})}),(0,a.jsxs)("p",{className:"coupon-code",children:[" ",(0,a.jsxs)("strong",{children:["‘",s.code,"’ applied"]})]}),(0,a.jsxs)("p",{className:"discount-saved",children:[" ",s.rate,"%"]}),(0,a.jsx)("p",{className:"discount-saved-text",children:"savings with this coupon"}),(0,a.jsxs)("div",{className:"summry",children:["Happy to have you back! Look out for great offers on every order",(0,a.jsx)("p",{className:"line-coupon"})]}),(0,a.jsx)("p",{className:"close-popup",onClick:()=>{i(!1),setTimeout(o,300)},children:"YAY!"})]})})},h=e=>{let{isVisible:s,onClose:t,onApplyCoupon:o,subtotal:c}=e,[i,n]=(0,r.useState)([]),[d,h]=(0,r.useState)(!0),[p,x]=(0,r.useState)(null),[j,v]=(0,r.useState)(null),[g,f]=(0,r.useState)(0),[N,y]=(0,r.useState)(null);if((0,r.useEffect)(()=>{let e=async()=>{h(!0);try{let e=localStorage.getItem("token");if(!e){y("User not authenticated");return}let s=await fetch("/api/coupons2",{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),t=await s.json();s.ok&&t.success?n(t.data):y(t.message||"Failed to fetch coupons.")}catch(e){console.error("Error fetching coupons:",e),y("Error fetching coupons.")}finally{h(!1)}};s&&e()},[s]),N)return(0,a.jsxs)("div",{children:["Error: ",N]});let I=e=>{x(p===e?null:e)},b=e=>{let s=(e.rate/100*c).toFixed(2);v(e),f(s),o(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"promo-code-popup-overlay ".concat(s?"show":""),children:(0,a.jsxs)("div",{className:"promo-code-popup-content",children:[(0,a.jsx)("div",{className:"top-title",children:(0,a.jsx)("div",{className:"promo-code-popup-header",children:(0,a.jsx)("img",{src:"/cross_icon.png",alt:"Close",className:"close-icon",onClick:t})})}),(0,a.jsx)("div",{className:"coupon-list",children:i.length>0?i.map(e=>{let s=c>=e.cartPrice,t=s?0:(e.cartPrice-c).toFixed(2);return(0,a.jsxs)("div",{className:"coupon-list1",children:[(0,a.jsx)("p",{className:"title",children:s?"Available Coupons":"Unavailable Coupons"}),(0,a.jsx)("p",{className:"code",children:e.code}),(0,a.jsxs)("p",{className:"flate-rate",children:["Get FLAT ",e.rate,"% off"]}),(0,a.jsxs)("p",{className:"rate-cart",children:["Use Code ",e.code," and get FLAT ",e.rate,"% off on orders above Rs.",e.cartPrice,". No Upper Limit."]}),(0,a.jsxs)("p",{className:"max-discount",children:["Maximum discount up to ₹",e.maxDiscount," on orders above ₹",e.cartPrice]}),p===e._id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"Terms",children:"Terms and Conditions"}),(0,a.jsxs)("div",{className:"dot-point1",children:[(0,a.jsx)("p",{className:"dot-point"}),(0,a.jsx)("p",{className:"terms-1",children:e.terms})]})]}):(0,a.jsxs)("p",{className:"more",onClick:()=>I(e._id),children:[(0,a.jsx)(l.G,{icon:u.r8p})," MORE"]}),(0,a.jsx)("div",{className:"apply-button",onClick:()=>s?b(e):null,children:s?"APPLY COUPON":"Add ₹".concat(Math.round(t)," more to available this offer")})]},e._id)}):(0,a.jsx)("p",{children:"No coupons available"})})]})}),j&&(0,a.jsx)(m,{coupon:j,discount:g,onClose:()=>{v(null)}})]})},p=()=>{let[e,s]=(0,r.useState)(null),[t,m]=(0,r.useState)(null),[p,x]=(0,r.useState)(!1),[j,v]=(0,r.useState)(!1),[g,f]=(0,r.useState)([]),N=(0,c.useRouter)(),[y,I]=(0,r.useState)(!1),[b,C]=(0,r.useState)(null),[k,S]=(0,r.useState)(!1),[E,F]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{F(!0)},[]),!E)return null;(0,r.useEffect)(()=>{let e=()=>{localStorage.removeItem("token"),v(!1),x(!0),N.push("/")},s=async()=>{try{let e=await o.Z.get("/api/adminSettings");e.data.success?(setAdminLocation(e.data.adminLocation),setDistanceThreshold(e.data.distanceThreshold)):console.error("Failed to fetch admin settings")}catch(e){console.error("Error fetching admin settings:",e.message)}},t=async s=>{try{let e=await o.Z.get("/api/getAddresses",{headers:{Authorization:"Bearer ".concat(s)}});e.data.success&&setSavedAddresses(e.data.deliveries)}catch(s){var t;(null===(t=s.response)||void 0===t?void 0:t.status)===401?e():console.error("Error fetching saved addresses:",s.message)}},a=async s=>{try{let e=await o.Z.get("/api/getCartItems",{headers:{Authorization:"Bearer ".concat(s)}});e.data.success?f(e.data.cartItems):console.error("Failed to fetch cart items")}catch(s){var t;(null===(t=s.response)||void 0===t?void 0:t.status)===401?e():console.error("Error fetching cart items:",s.message)}},r=async s=>{try{let e=await o.Z.get("/api/getCartInfo",{headers:{Authorization:"Bearer ".concat(s)}});e.data.success?(setCartTotal(e.data.cartTotal),setSelectedCartTotalId(e.data.cartTotal._id),setSelectedAddressId(e.data.selectedAddressId)):console.error("Failed to fetch cart total")}catch(s){var t;(null===(t=s.response)||void 0===t?void 0:t.status)===401?e():console.error("Error fetching cart total:",s.message)}finally{S(!1)}},c=localStorage.getItem("token");c?(v(!0),t(c),a(c),r(c)):e(),s()},[N]);let w=async(e,s)=>{try{let t=localStorage.getItem("token"),a=await o.Z.put("/api/updateCartItem",{itemId:e,quantity:s},{headers:{Authorization:"Bearer ".concat(t)}});a.data.success?f(t=>t.map(t=>t._id===e?{...t,quantity:s}:t)):"TokenExpired"===a.data.error?A():m(a.data.message)}catch(e){e.response&&401===e.response.status?A():(console.error("Error updating cart item:",e),m("Error updating cart item"))}},T=async e=>{try{let s=localStorage.getItem("token"),t=await o.Z.delete("/api/removeCartItem",{headers:{Authorization:"Bearer ".concat(s)},data:{itemId:e}});t.data.success?f(s=>s.filter(s=>s._id!==e)):"TokenExpired"===t.data.error?A():m(t.data.message)}catch(e){e.response&&401===e.response.status?A():(console.error("Error removing cart item:",e),m("Error removing cart item"))}},A=()=>{localStorage.removeItem("token"),v(!1),x(!0)},_=(e,s)=>{w(e,s+1)},P=(e,s)=>{s>1?w(e,s-1):T(e)},L=g.reduce((e,s)=>{if(s.foodId){let t=s.foodId.price,a=s.foodId.discount/100*t;return e+(t-(t-a))*s.quantity}return e},0),O=g.reduce((e,s)=>{if(s.foodId){let t=s.foodId.price,a=t*(1-s.foodId.discount/100),r=b?t*(1-b.rate/100):a;return e+s.foodId.gstRate/100*r*s.quantity}return e},0),q=g.reduce((e,s)=>s.foodId?e+s.foodId.price*s.quantity:e,0);b&&b.cartPrice,(0,r.useEffect)(()=>{b&&q<b.cartPrice&&C(null)},[q,b]);let D=async()=>{if(0===g.length)m("Please add items to the cart before proceeding to checkout.");else{S(!0);try{await R(),N.push("/Order")}catch(e){console.error("Error saving cart total:",e),m("An error occurred while saving the cart. Please try again.")}}},R=async()=>{let e={subtotal:Number(q.toFixed(2)),itemDiscount:Number(b?0:L.toFixed(2)),couponDiscount:b?Number(Math.min((q*b.rate/100).toFixed(2),b.maxDiscount).toFixed(2)):0,deliveryFee:Number("0.00"),totalGst:Number(O.toFixed(2)),total:Number((q-(b?0:L)-(b?q*b.rate/100:0)+0+O).toFixed(2)),couponId:b?b._id:null,couponStatus:"active"};try{let s=localStorage.getItem("token");if(!s){m("No token found"),S(!1);return}let t=await fetch("/api/saveCartTotal",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(e)}),a=await t.json();a.success||console.error("Failed to save cart total:",a.message)}catch(e){console.error("Error saving cart total:",e)}finally{S(!1)}};return(0,a.jsxs)(a.Fragment,{children:[p&&!j&&(0,a.jsx)(d.Z,{setShowLogin:x,setIsLoggedIn:v}),(0,a.jsx)("div",{className:"back-navbar",children:(0,a.jsx)("div",{className:"app",children:(0,a.jsxs)("div",{className:"navbar-fixed",children:[(0,a.jsx)(i.Z,{isLoggedIn:j,setShowLogin:x,handleLogout:()=>{localStorage.removeItem("token"),v(!1),x(!0),N.push("/")}}),(0,a.jsx)("div",{className:"back-arrow",children:(0,a.jsx)(l.G,{icon:u.acZ,className:"back-arrow-icon",onClick:()=>N.back()})})]})})}),(0,a.jsx)("div",{className:"app",children:(0,a.jsx)("div",{className:"cart-page",children:(0,a.jsxs)("div",{className:"cart-container",children:[(0,a.jsx)("div",{className:"cart-header"}),(0,a.jsxs)("div",{className:"cart-body",children:[(0,a.jsxs)("div",{className:"cart-header1",children:[(0,a.jsx)("span",{children:"Item"}),(0,a.jsx)("span",{children:"Title"}),(0,a.jsx)("span",{children:"Rate"}),(0,a.jsx)("span",{children:"Qty"}),(0,a.jsx)("span",{children:"Tax"}),(0,a.jsx)("span",{children:"Amount"}),(0,a.jsx)("span",{children:"Remove"})]}),(0,a.jsxs)("div",{className:"cart-items-container",children:[t&&(0,a.jsx)("p",{className:"error-message",children:t}),0===g.length?(0,a.jsx)("p",{children:"Your cart is empty"}):g.map(e=>(0,a.jsxs)("div",{className:"cart-item",children:[(0,a.jsx)("div",{className:"cart-item-img",children:e.foodId&&(0,a.jsx)("img",{src:e.foodId.imageUrl,alt:e.foodId.name,className:"item-image"})}),(0,a.jsx)("div",{className:"cart-item-details",children:(0,a.jsx)("h3",{children:e.foodId?e.foodId.name:"Unknown Item"})}),(0,a.jsxs)("div",{className:"cart-item-price1",children:[(0,a.jsxs)("p",{className:"original-price2",children:["₹",e.foodId?e.foodId.price:"N/A"]}),(0,a.jsxs)("p",{className:"discounted-price3",children:["₹",e.foodId?e.foodId.price-e.foodId.price*(e.foodId.discount/100):"N/A"]})]}),(0,a.jsx)("div",{className:"quantity-item",children:(0,a.jsxs)("div",{className:"cart-item-quantity",children:[(0,a.jsx)("button",{onClick:()=>P(e._id,e.quantity),children:"-"}),(0,a.jsx)("p",{children:e.quantity}),(0,a.jsx)("button",{onClick:()=>_(e._id,e.quantity),children:"+"})]})}),(0,a.jsx)("div",{className:"cart-item-price",children:(0,a.jsxs)("p",{children:[e.foodId?e.foodId.gstRate:"N/A","%"]})}),(0,a.jsx)("div",{className:"cart-item-total",children:(0,a.jsxs)("p",{children:["₹",e.foodId?(e.foodId.price-e.foodId.price*(e.foodId.discount/100))*e.quantity:"N/A"]})}),(0,a.jsx)("div",{className:"cart-item-remove",children:(0,a.jsx)("img",{src:"/cross_icon.png",alt:"Remove",onClick:()=>T(e._id),className:"remove-icon"})})]},e._id))]})]}),(0,a.jsxs)("div",{className:"cart-bottom",children:[(0,a.jsxs)("div",{className:"cart-total",children:[(0,a.jsx)("h2",{children:"Cart Total"}),(0,a.jsxs)("div",{className:"cart-total-details",children:[(0,a.jsx)("p",{children:"Subtotal"}),(0,a.jsxs)("p",{children:["₹",q.toFixed(2)]})]}),(0,a.jsx)("hr",{}),b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"cart-total-details",children:[(0,a.jsx)("p",{children:"Coupon Discount"}),(0,a.jsxs)("p",{children:["-₹",Math.min(q*b.rate/100,b.maxDiscount).toFixed(2)]})]}),(0,a.jsx)("hr",{})]}):(0,a.jsx)(a.Fragment,{children:L>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"cart-total-details",children:[(0,a.jsx)("p",{children:"Item Discount"}),(0,a.jsxs)("p",{children:["-₹",L.toFixed(2)]})]}),(0,a.jsx)("hr",{})]})}),O>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"cart-total-details",children:[(0,a.jsx)("p",{children:"GST"}),(0,a.jsxs)("p",{children:["+₹",O.toFixed(2)]})]}),(0,a.jsx)("hr",{})]}),(0,a.jsxs)("div",{className:"cart-total-details",children:[(0,a.jsx)("p",{children:"Delivery Fee"}),(0,a.jsxs)("p",{children:["+₹",0]})]}),(0,a.jsx)("hr",{}),(0,a.jsxs)("div",{className:"cart-total-details",children:[(0,a.jsx)("b",{children:"Total"}),(0,a.jsxs)("b",{children:["₹",(q-(b?0:L)-(b?q*b.rate/100:0)+0+O).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"checkout-button",children:[t&&(0,a.jsx)("div",{className:"error-message",children:t}),(0,a.jsx)("button",{onClick:D,disabled:k,children:k?"Processing...":"PROCEED TO CHECKOUT"})]})]}),(0,a.jsx)("div",{className:"cart-promocode",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"If you want coupon code list, enter it here:"}),(0,a.jsxs)("div",{className:"cart-promocode-input",children:[b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"text",value:b.code,placeholder:"Promo code",readOnly:!0}),(0,a.jsx)("img",{src:"/cross_icon.png",alt:"Remove",onClick:()=>C(null),className:"remove-icon"})]}):(0,a.jsx)("input",{type:"text",placeholder:"Enter promo code",onClick:()=>{I(!0)}}),(0,a.jsx)("button",{children:"Apply Coupon"})]})]})})]})]})})}),(0,a.jsx)(h,{isVisible:y,onClose:()=>I(!1),onApplyCoupon:e=>{C(e),I(!1)},subtotal:q,userId:e}),(0,a.jsx)(n.Z,{})]})}},80317:function(){},33605:function(){},29616:function(){},11163:function(e,s,t){e.exports=t(37253)}},function(e){e.O(0,[976,603,128,66,221,498,888,774,179],function(){return e(e.s=43726)}),_N_E=e.O()}]);