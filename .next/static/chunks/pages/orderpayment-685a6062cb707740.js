(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[164],{17727:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/orderpayment",function(){return s(80020)}])},80020:function(e,a,s){"use strict";s.r(a);var t=s(85893),n=s(67294),i=s(87066),l=s(11163),r=s(99603),c=s(59417),o=s(11222),d=s(35234),u=s(59103);s(22148),s(80317),s(72422),s(3877),a.default=e=>{let{cartItems:a=[],totalAmount:s,selectedAddress:h,userId:m}=e,[p,x]=(0,n.useState)([]),[j,v]=(0,n.useState)(""),[g,N]=(0,n.useState)(""),[y,f]=(0,n.useState)(""),[k,w]=(0,n.useState)(""),[S,b]=(0,n.useState)(""),[C,_]=(0,n.useState)(!1),[E,D]=(0,n.useState)(!1),[O,L]=(0,n.useState)(!1),[R,I]=(0,n.useState)(!1),P=(0,l.useRouter)(),[T,Z]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{Z(!0)},[]),!T)return null;(0,n.useEffect)(()=>{let e=()=>{localStorage.removeItem("token"),D(!1),_(!0),P.push("/")},a=async()=>{try{let a=await i.Z.get("/api/paymentshow",{headers:S?{Authorization:"Bearer ".concat(S)}:{}});a.data.success?x(a.data.data||[]):"Token expired"===a.data.error?e():console.error("Failed to fetch payment methods:",a.data.message)}catch(s){var a;(null===(a=s.response)||void 0===a?void 0:a.status)===401?e():console.error("Error fetching payment methods:",s.message)}};{let e=localStorage.getItem("token");e?(b(e),D(!0),a()):(_(!0),P.push("/"))}},[S,P]);let U=e=>{v(e),N(""),f("")},A=e=>{let a=e.target.value;/^\d*$/.test(a)?(N(a),f("")):f("Please enter a valid 12-digit UTR.")},F=async e=>{e.preventDefault(),I(!0);try{let e=localStorage.getItem("token"),a=await i.Z.post("/api/order",{paymentMethod:j,UTR:"CashOnDelivery"===j?null:g},{headers:{Authorization:"Bearer ".concat(e)}});if(a.data.success){let a=await i.Z.post("/api/couponstatusupdate",{token:e,couponStatus:"active"},{headers:{Authorization:"Bearer ".concat(e)}});a.data.success?P.push("/MyOrder"):w(a.data.message||"Failed to update coupon status.")}else w(a.data.message||"Failed to place the order.")}catch(e){console.error("Error during submission:",e),w("Your UTR Wrong. Please try again later.")}finally{I(!1)}};return(0,t.jsxs)(t.Fragment,{children:[C&&!E&&(0,t.jsx)(u.Z,{setShowLogin:_,setIsLoggedIn:D}),O&&(0,t.jsxs)("div",{className:"popup small-popup",children:[(0,t.jsx)("p",{children:k}),(0,t.jsx)("button",{onClick:()=>{L(!1)},children:"Close"})]}),(0,t.jsx)("div",{className:"back-navbar",children:(0,t.jsx)("div",{className:"app",children:(0,t.jsxs)("div",{className:"navbar-fixed",children:[(0,t.jsx)(o.Z,{isLoggedIn:E,setShowLogin:_,handleLogout:()=>{localStorage.removeItem("token"),D(!1),_(!0),P.push("/")}}),(0,t.jsx)("div",{className:"back-arrow",children:(0,t.jsx)(r.G,{icon:c.acZ,className:"back-arrow-icon",onClick:()=>P.back()})})]})})}),(0,t.jsx)("div",{className:"app",children:(0,t.jsx)("div",{className:"order-payment-wrapper",children:(0,t.jsxs)("div",{className:"order-payment-container",children:[(0,t.jsxs)("div",{className:"column options-column",children:[(0,t.jsx)("h1",{children:"Payment Options"}),(0,t.jsxs)("div",{className:"options-list",children:[p.length>0?p.map(e=>(0,t.jsxs)("div",{className:"option-item ".concat(j===e.title?"selected":""),onClick:()=>U(e.title),children:[(0,t.jsx)("div",{className:"circle"}),(0,t.jsx)("span",{children:e.title})]},e._id)):(0,t.jsx)("p",{children:"Loading..."}),(0,t.jsxs)("div",{className:"option-item ".concat("CashOnDelivery"===j?"selected":""),onClick:()=>U("CashOnDelivery"),children:[(0,t.jsx)("div",{className:"circle"}),(0,t.jsx)("span",{children:"Cash on Delivery"})]})]})]}),(0,t.jsxs)("div",{className:"column details-column",children:[j&&(0,t.jsx)("div",{className:"details-content",children:"CashOnDelivery"===j?(0,t.jsx)("div",{className:"cash-on-delivery",children:(0,t.jsx)("p",{children:"Selected Cash on Delivery. You can proceed to submit."})}):p.filter(e=>e.title===j).map(e=>(0,t.jsxs)("div",{className:"payment-details",children:[(0,t.jsx)("img",{src:e.imageUrl,alt:e.title,className:"payment-image"}),(0,t.jsx)("div",{className:"download",children:(0,t.jsx)("a",{href:e.imageUrl,download:"".concat(e.title,".png"),className:"download-link",children:"Download QR"})}),(0,t.jsx)("p",{children:e.name}),(0,t.jsx)("label",{children:(0,t.jsx)("input",{type:"text",value:g,onChange:A,placeholder:"Enter UTR 12-digit here",className:"payment-input ".concat(y?"input-error":""),maxLength:12,required:!0})}),y&&(0,t.jsx)("p",{className:"error-message",children:y})]},e._id))}),j&&(0,t.jsx)("button",{onClick:F,className:"submit-button1",disabled:R,children:R?"Processing...":"PLACE ORDER"}),k&&(0,t.jsx)("p",{className:"error-message",children:k})]})]})})}),(0,t.jsx)(d.Z,{})]})}},80317:function(){},3877:function(){},22148:function(){},11163:function(e,a,s){e.exports=s(37253)}},function(e){e.O(0,[976,603,128,66,221,498,888,774,179],function(){return e(e.s=17727)}),_N_E=e.O()}]);