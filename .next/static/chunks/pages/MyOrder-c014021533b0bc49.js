(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[652],{58873:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/MyOrder",function(){return a(53207)}])},53207:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return m}});var t=a(85893),r=a(67294),i=a(87066),c=a(11163),n=a(11222),l=a(35234),o=a(59103);a(35880);var d=a(99603),u=a(59417),h=e=>{let{orderId:s,orderItemName:a,closeReviewPopup:c}=e,[n,l]=(0,r.useState)(""),[o,h]=(0,r.useState)({}),[m,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await i.Z.get("/api/reviews/".concat(s));if(e.data.success){p(e.data.data),l(e.data.data.comment||"");let s={};e.data.data.reviews.forEach(e=>{let{item:a,rating:t}=e;s[a]=t}),h(s)}}catch(e){console.error("Fetch error:",e)}})()},[s]);let v=(e,s)=>{h(a=>({...a,[e]:s}))},x=async e=>{e.preventDefault();let a=Object.keys(o).map(e=>({item:e,rating:o[e]}));try{(await i.Z.post("/api/reviews",{orderId:s,reviews:a,comment:n})).data.success?c():alert("Failed to submit review")}catch(e){console.error("Error submitting review:",e),alert("Error submitting review")}};return(0,t.jsx)("div",{className:"review-popup",children:(0,t.jsxs)("div",{className:"review-popup-content",children:[(0,t.jsxs)("div",{className:"popup-header",children:[(0,t.jsx)("h2",{className:"popup-title",children:"Review Your Order"}),(0,t.jsx)(d.G,{icon:u.NBC,className:"close-icon",onClick:c})]}),(0,t.jsx)("hr",{}),(0,t.jsxs)("div",{className:"food-items",children:[(0,t.jsx)("h3",{className:"restaurant-review-title",children:"Food Review"}),a.split(", ").map((e,s)=>(0,t.jsxs)("div",{className:"food-item",children:[(0,t.jsx)("span",{children:e}),(0,t.jsx)("div",{className:"star-rating",children:[1,2,3,4,5].map(s=>(0,t.jsx)("span",{className:"star ".concat(o[e]>=s?"filled":""),onClick:()=>v(e,s),children:"★"},s))})]},s))]}),(0,t.jsx)("hr",{}),(0,t.jsx)("h3",{className:"delivery-review-title",children:"Restaurant Review"}),(0,t.jsxs)("div",{className:"delivery-item",children:[(0,t.jsx)("span",{children:"Restaurant"}),(0,t.jsx)("div",{className:"star-rating",children:[1,2,3,4,5].map(e=>(0,t.jsx)("span",{className:"star ".concat(o.Restaurant>=e?"filled":""),onClick:()=>v("Restaurant",e),children:"★"},e))})]}),(0,t.jsx)("hr",{}),(0,t.jsx)("h3",{className:"delivery-review-title",children:"Delivery Review"}),(0,t.jsxs)("div",{className:"delivery-item",children:[(0,t.jsx)("span",{children:"Delivery Boy"}),(0,t.jsx)("div",{className:"star-rating",children:[1,2,3,4,5].map(e=>(0,t.jsx)("span",{className:"star ".concat(o["Delivery Boy"]>=e?"filled":""),onClick:()=>v("Delivery Boy",e),children:"★"},e))})]}),(0,t.jsx)("hr",{}),(0,t.jsxs)("div",{className:"delivery-item1",children:[(0,t.jsx)("span",{children:"Comment"}),(0,t.jsx)("textarea",{rows:"4",className:"review-textarea",placeholder:"Write your review...",value:n,onChange:e=>l(e.target.value)})]}),(0,t.jsx)("button",{className:"submit-button",onClick:x,children:m?"Update Review":"Submit Review"})]})})};a(80317),a(72422),a(3877),a(47536);var m=()=>{let[e,s]=(0,r.useState)(null),[a,m]=(0,r.useState)(!1),[p,v]=(0,r.useState)(!1),[x,j]=(0,r.useState)([]),[f,N]=(0,r.useState)(0),[w,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(""),[k,S]=(0,r.useState)(null),[_,C]=(0,r.useState)(!1),[E,O]=(0,r.useState)(null),[R,I]=(0,r.useState)(""),[Z,D]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{D(!0)},[]),!Z)return null;let F=(0,c.useRouter)();(0,r.useEffect)(()=>{let e=async e=>{try{let s=await i.Z.get("/api/getOrders",{headers:{Authorization:"Bearer ".concat(e)}});s.data.success?(j(s.data.orderPayments),N(a(s.data.orderPayments))):t()}catch(e){var r;(null===(r=e.response)||void 0===r?void 0:r.status)===401?t():(console.error("Error fetching orders:",e.response||e.message),s("Error fetching orders"))}},a=e=>e.reduce((e,s)=>e+s.amount,0),t=()=>{localStorage.removeItem("token"),v(!1),m(!0),F.push("/")};(async()=>{let s=localStorage.getItem("token");s?(v(!0),await e(s)):t()})()},[F]);let B=async e=>{try{let a=await i.Z.get("/api/getOrderStatus?orderId=".concat(e));a.data.success?j(s=>s.map(s=>s._id===e?{...s,status:a.data.status}:s)):s("Failed to fetch order status")}catch(e){console.error("Error fetching order status:",e),s("Error fetching order status")}},L=async e=>{let a=x.find(s=>s._id===e);if(!a){console.error("Order not found");return}if("Out for delivery"===a.status||"Delivered"===a.status){b("Your order is ".concat(a.status,". You cannot cancel it.")),S(e),g(!0);return}try{(await i.Z.put("/api/updateOrderStatus1",{orderId:e,status:"Cancelled"})).data.success?j(s=>s.map(s=>s._id===e?{...s,status:"Cancelled"}:s)):s("Failed to cancel order")}catch(e){console.error("Error cancelling order:",e),s("Error cancelling order")}},P=(e,s)=>{O(e),I(s),C(!0)};return(0,t.jsxs)(t.Fragment,{children:[a&&!p&&(0,t.jsx)(o.Z,{setShowLogin:m,setIsLoggedIn:v}),w&&(0,t.jsxs)("div",{className:"popup small-popup",children:[(0,t.jsx)("p",{children:y}),(0,t.jsx)("button",{onClick:()=>{g(!1),b(""),S(null)},children:"Close"})]}),(0,t.jsx)("div",{className:"back-navbar",children:(0,t.jsx)("div",{className:"app",children:(0,t.jsxs)("div",{className:"navbar-fixed",children:[(0,t.jsx)(n.Z,{isLoggedIn:p,setShowLogin:m,handleLogout:()=>{localStorage.removeItem("token"),v(!1),m(!0),F.push("/")}}),(0,t.jsx)("div",{className:"back-arrow",children:(0,t.jsx)(d.G,{icon:u.acZ,className:"back-arrow-icon",onClick:()=>F.back()})})]})})}),(0,t.jsx)("div",{className:"app",children:(0,t.jsxs)("div",{className:"my-orders",children:[(0,t.jsx)("h2",{children:"My Orders"}),e&&(0,t.jsx)("p",{className:"error",children:e}),(0,t.jsx)("div",{className:"container",children:0===x.length?(0,t.jsx)("p",{children:"No orders found"}):x.slice().reverse().map(e=>{let s=e.items.filter(e=>e.foodId).map(e=>"".concat(e.foodId.name," x ").concat(e.quantity)).join(", ");return(0,t.jsxs)("div",{className:"my-orders-order",children:[(0,t.jsx)("img",{src:"/parcel_icon.png",alt:"parcel icon"}),(0,t.jsx)("p",{children:s}),(0,t.jsxs)("p",{children:[" ",(0,t.jsx)("span",{className:"tometo",children:"₹ "}),e.totalAmount]}),(0,t.jsxs)("p",{children:["Items",(0,t.jsx)("span",{className:"tometo",children:":"})," ",e.items.length]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{children:"●"})," ",(0,t.jsx)("b",{children:e.status})]}),(0,t.jsx)("button",{onClick:()=>B(e._id),children:"Track Order"}),(0,t.jsx)("button",{onClick:()=>L(e._id),className:"cancel-button",disabled:"Out for delivery"===e.status||"Delivered"===e.status,children:"Cancel"}),"Delivered"===e.status&&(0,t.jsx)("button",{onClick:()=>P(e._id,s),children:"Add Review"})]},e._id)})})]})}),_&&(0,t.jsx)(h,{orderId:E,orderItemName:R,closeReviewPopup:()=>{C(!1)}}),(0,t.jsx)(l.Z,{})]})}},80317:function(){},35880:function(){},47536:function(){},3877:function(){},11163:function(e,s,a){e.exports=a(37253)}},function(e){e.O(0,[976,603,128,66,221,498,888,774,179],function(){return e(e.s=58873)}),_N_E=e.O()}]);