(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[889],{87291:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Table-Order",function(){return a(58166)}])},41223:function(){},85029:function(){},52690:function(){},92081:function(){},57361:function(){},65949:function(){},58166:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var n=a(85893),s=a(67294);a(85029);var i=a(44173);a(44440);var l=()=>{let[e,t]=(0,s.useState)(""),[a,l]=(0,s.useState)(""),[r,d]=(0,s.useState)(!1),o=async n=>{if(n.preventDefault(),!e||!a){i.Am.error("Both fields are required.",{position:"top-right"});return}d(!0);try{let n=await fetch("/api/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:e,seatNumber:a})});if(n.ok){let e=await n.json();i.Am.success('Table "'.concat(e.table.tableName,'" added successfully!'),{position:"top-right"}),t(""),l("")}else{let e=await n.json();i.Am.error(e.error||"Failed to add the table.",{position:"top-right"})}}catch(e){console.error("Error adding table:",e),i.Am.error("An error occurred. Please try again.",{position:"top-right"})}finally{d(!1)}};return(0,n.jsxs)("div",{className:"add-table-container",children:[(0,n.jsx)(i.Ix,{})," ",(0,n.jsx)("h3",{className:"form-title",children:"Add Restaurant Table"}),(0,n.jsxs)("form",{onSubmit:o,className:"form",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"tableName",className:"label",children:"Table Name"}),(0,n.jsx)("input",{type:"text",id:"tableName",className:"input",value:e,onChange:e=>t(e.target.value),placeholder:"Enter Table Name",required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"seatNumber",className:"label",children:"Total Seat"}),(0,n.jsx)("input",{type:"number",id:"seatNumber",className:"input",value:a,onChange:e=>l(e.target.value),placeholder:"Enter Seat Number",required:!0})]}),(0,n.jsx)("div",{className:"form-group1",children:(0,n.jsx)("button",{type:"submit",className:"btn-submit",disabled:r,children:r?"Adding...":"Add Table"})})]})]})},r=a(99603),d=a(59417);a(41223);var o=e=>{let{table:t,onClose:a,onUpdate:l}=e,[o,c]=(0,s.useState)(t.orderItems||[]),[m,p]=(0,s.useState)([]),[u,x]=(0,s.useState)([]),[h,v]=(0,s.useState)(""),[b,j]=(0,s.useState)(""),[g,y]=(0,s.useState)(t.customerName||""),[f,N]=(0,s.useState)(t.mobileNumber||""),[w,S]=(0,s.useState)(t.seatNumber||""),[C,T]=(0,s.useState)(!1),[k,P]=(0,s.useState)(""),[A,E]=(0,s.useState)(!1),[q,F]=(0,s.useState)(o);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/categories"),t=await e.json();p(t)}catch(e){console.error("Error fetching categories:",e)}})()},[]),(0,s.useEffect)(()=>{(async()=>{if(h)try{let e=await fetch("/api/itemtable?category=".concat(h)),t=await e.json();x(t)}catch(e){console.error("Error fetching items:",e)}})()},[h]);let I=(e,t)=>{c(a=>a.map((a,n)=>{if(n===e&&"Pending"===a.itemstatus){let e=Math.max(1,a.quantity+t);return{...a,quantity:e,total:e*a.price}}return a}))},O=e=>{c(t=>t.filter((t,a)=>a!==e))},_=()=>o.reduce((e,t)=>e+t.total,0),D=async(e,a)=>{let n=[...o];n[e].itemstatus=a,c(n);try{let n=await fetch("/api/updateitems",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:t._id,itemId:o[e]._id,newStatus:a})}),s=await n.json();n.ok?i.Am.success("Status updated successfully!",{position:"top-right",autoClose:3e3}):i.Am.error(s.message||"Failed to update status.",{position:"top-right",autoClose:3e3})}catch(e){console.error("Error updating status:",e),i.Am.error("Error updating status.",{position:"top-right",autoClose:3e3})}},R=async()=>{let e={customerName:g,mobileNumber:f,seatNumber:w,orderItems:o,totalPrice:_()};if(!t._id){console.error("Table ID is missing");return}try{T(!0);let n=await fetch("/api/updatetable",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:t._id,updatedOrderData:e})}),s=await n.json();T(!1),n.ok?(i.Am.success("Order updated successfully!",{autoClose:3e3}),o.length>q.length&&z(),F(o),l(s.table),a()):console.error(s.message||"Failed to update the order")}catch(e){T(!1),console.error("Error updating order:",e)}},z=()=>{let e=o.filter(e=>!q.some(t=>t.name===e.name));if(0===e.length){console.log("No new items to print.");return}let a=new Date,n=String(a.getDate()).padStart(2,"0"),s=String(a.getMonth()+1).padStart(2,"0"),i=a.getFullYear(),l=a.getHours(),r=String(a.getMinutes()).padStart(2,"0"),d=l>=12?"PM":"AM";l%=12,l=l?String(l).padStart(2,"0"):"12";let c="".concat(n,"/").concat(s,"/").concat(i),m="".concat(l,":").concat(r," ").concat(d),p='\n    <div style="font-family: Arial, sans-serif; font-size: 14px; padding: 0; line-height: 1.4; max-width: 300px; margin: 0 auto; margin-left:-6px; margin-right:10px;">\n      <h2 style="text-align: center; margin-bottom: 2px;">Tomato Restaurant</h2>\n     \n  \n    \n      <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: #333; font-weight: bold;">\n         <div>\n      Kitchen Slip\n    </div>\n        <div>Table: '.concat(t.tableNumber,'</div>\n     \n\n\n      </div>\n      <div style="display: flex; justify-content: space-between; font-size: 12px;">\n    <div>Date: ').concat(c,"</div>\n        <div>Time: ").concat(m,'</div>\n    </div>\n    \n  \n      <div style="border-bottom: 1px dotted #000; margin-bottom: 10px;"></div>\n  \n      <div style="font-weight: bold; font-size: 12px;">\n        <div style="display: flex; justify-content: space-between; text-align: center;">\n          <span style="flex: 3; text-align: left;">Item Name</span>\n          <span style="flex: 1;text-align:right;">Qty</span>\n        </div>\n      </div>\n  \n      <div style="border-bottom: 1px dotted #000; margin-bottom: 10px;"></div>\n  \n      \n       ').concat(e.map(e=>'\n        <div style="display: flex; justify-content: space-between; text-align: center;">\n          <span style="flex: 1; text-align: left;">'.concat(e.name,'</span>\n          <span style="flex: 1;text-align:right;">').concat(e.quantity,"</span>\n        </div>\n      ")).join(""),'\n          <div style="flex: 1; border-top: 1px dotted #000;margin-top: 7px;"></div>\n <div style="margin-bottom: 4px; margin-top: 8px;line-height: 1.6;">\n \n Note:  <div style="font-size:8px"> ').concat(k||"No remarks entered.",'</div>\n </div>\n\n    <div style="flex: 1; border-top: 1px dotted #000;"></div>\n      <div style="display: flex; align-items: center; font-weight: bold; font-size: 14px; margin-top: 10px; margin-bottom: 20px;">\n        <div style="flex: 1; border-top: 1px dotted #000;"></div>\n        <div style="padding: 0 10px; text-align: center;">\n        Items Prepared Quickly\n        </div>\n        <div style="flex: 1; border-top: 1px dotted #000;"></div>\n      </div>\n\n\n    </div>\n  '),u=window.open("width=350,height=600");u.document.write('\n    <!DOCTYPE html>\n    <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Bill</title>\n      </head>\n      <body>\n        '.concat(p,"\n      </body>\n    </html>\n  ")),u.document.close(),u.print()};return(0,n.jsx)("div",{className:"popup-overlay",children:(0,n.jsxs)("div",{className:"popup-content",children:[(0,n.jsxs)("div",{className:"top-row",children:[(0,n.jsxs)("h2",{children:["Table No: ",t.tableNumber]}),(0,n.jsxs)("h2",{children:["Max Pax: ",t.maxPax]})]}),(0,n.jsxs)("div",{className:"input-row",children:[(0,n.jsx)("input",{type:"text",placeholder:"Customer Name *",value:g,onChange:e=>y(e.target.value)}),(0,n.jsx)("input",{type:"text",placeholder:"Mobile Number",value:f,onChange:e=>N(e.target.value)}),(0,n.jsx)("input",{type:"number",placeholder:"Pax",value:w,onChange:e=>S(e.target.value)})]}),(0,n.jsxs)("div",{className:"input-row",children:[(0,n.jsxs)("select",{value:h,onChange:e=>v(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Select Category"}),m.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e._id))]}),(0,n.jsxs)("select",{value:b,onChange:e=>j(e.target.value),disabled:!h,children:[(0,n.jsx)("option",{value:"",children:"Select Item"}),u.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e._id))]}),(0,n.jsx)("button",{onClick:()=>{if(!b)return;let e=u.find(e=>e.name===b);if(!e)return;let t={itemId:e._id,name:e.name,price:e.price,quantity:1,total:e.price,itemstatus:"Pending",discount:e.discount,gstRate:e.gstRate};c(e=>e.filter(e=>e.name===b&&"Pending"===e.itemstatus).length>0?e.map(e=>e.name===b&&"Pending"===e.itemstatus?{...e,quantity:e.quantity+1,total:(e.quantity+1)*e.price}:e):[...e,t]),j("")},children:"Add"})]}),(0,n.jsx)("div",{className:"order-items-container",children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"S.No."}),(0,n.jsx)("th",{children:"Item Name"}),(0,n.jsx)("th",{children:"Quantity"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Price"}),(0,n.jsx)("th",{children:"Total"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:o.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:e.name}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"order-incress",children:(0,n.jsxs)("div",{className:"quantity-order",children:[(0,n.jsx)("button",{onClick:()=>I(t,-1),disabled:"Pending"!==e.itemstatus,children:"-"}),e.quantity,(0,n.jsx)("button",{onClick:()=>I(t,1),disabled:"Pending"!==e.itemstatus,children:"+"})]})})}),(0,n.jsx)("td",{children:(0,n.jsxs)("select",{className:"status-dropdown1",value:e.itemstatus,onChange:e=>D(t,e.target.value),children:[(0,n.jsx)("option",{value:"Pending",children:"Pending"}),(0,n.jsx)("option",{value:"Preparing",children:"Preparing"}),(0,n.jsx)("option",{value:"Ready",children:"Ready"}),(0,n.jsx)("option",{value:"Served",children:"Served"}),(0,n.jsx)("option",{value:"Cancelled",children:"Cancelled"})]})}),(0,n.jsx)("td",{children:e.price}),(0,n.jsx)("td",{children:e.total}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{className:"delete-button",onClick:()=>O(t),disabled:"Pending"!==e.itemstatus,children:(0,n.jsx)(r.G,{icon:d.NBC})})})]},t))})]})}),(0,n.jsxs)("div",{className:"bottom-row",children:[(0,n.jsx)("button",{onClick:a,children:"Close"}),(0,n.jsx)("button",{onClick:()=>{E(!0)},children:"Remark"}),(0,n.jsx)("button",{onClick:R,children:C?"Updating...":"Update Order (₹".concat(_(),")")})]}),A&&(0,n.jsx)("div",{className:"popup-remake",children:(0,n.jsxs)("div",{className:"popup-content-remake",children:[(0,n.jsx)("div",{className:"popup-header-remake",children:(0,n.jsx)("h3",{className:"remark",children:"Remark"})}),(0,n.jsxs)("div",{className:"popup-body-remake",children:[(0,n.jsx)("label",{htmlFor:"description",children:(0,n.jsx)("div",{className:"description1",children:"Note:"})}),(0,n.jsx)("textarea",{id:"description",value:k,onChange:e=>P(e.target.value),placeholder:"Enter your remark here",rows:5,style:{width:"100%",padding:"8px",fontSize:"14px",border:"1px solid #ccc",borderRadius:"4px"}})]}),(0,n.jsxs)("div",{className:"popup-footer-remake",children:[(0,n.jsx)("button",{onClick:()=>{E(!1)},children:"Close"}),(0,n.jsx)("button",{onClick:()=>{console.log("Remark Saved:",k),E(!1)},children:"Save"})]})]})})]})})};a(92081);var c=a(87066);a(52690);var m=e=>{let{table:t,onClose:a}=e,[i,l]=(0,s.useState)(0),[r,d]=(0,s.useState)(t.totalPrice);(0,s.useEffect)(()=>{o()},[i]);let o=()=>{let e=t.orderItems.reduce((e,t)=>e+t.price*t.quantity*t.discount/100,0),a=t.totalPrice-e,n=a*i/100;d(a-n+t.orderItems.reduce((e,t)=>{let a=t.price*t.quantity,n=a-a*t.discount/100;return e+(n-n*i/100)*t.gstRate/100},0))},m=t.orderItems.reduce((e,t)=>e+t.price*t.quantity*t.discount/100,0),p=t.orderItems.reduce((e,t)=>{let a=t.price*t.quantity;return e+(a-a*t.discount/100)*t.gstRate/100},0),u=async()=>{try{let e=await c.Z.put("/api/updateTableStatus",{tableName:t.tableNumber,status:"available"});200===e.status?x():console.error("Failed to update table status")}catch(e){console.error("Network error:",e)}},x=()=>{let e='\n    <div style="font-family: Arial, sans-serif; font-size: 14px; padding: 0; line-height: 1.4; max-width: 300px; margin: 0 auto; margin-left:-6px; margin-right:10px">\n      <h2 style="text-align: center; margin-bottom: 2px;">Tomato Restaurant</h2>\n     <div style="text-align: center; margin-bottom: 2px;">\n  <div>32/1C, New Sanganer Rd, Sanganer</div>\n  <div>Sector 3, Pratap Nagar, Jaipur</div>\n  \n</div>\n\n<div style="text-align: center; margin-bottom: 4px;">\n  MOB. 9001409003\n</div>\n\n      <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 12px;">\n         <div>Customer: '.concat(t.customerName.length>6?t.customerName.slice(0,6)+"...":t.customerName,"</div>\n        <div>Table: ").concat(t.tableNumber,"</div>\n        <div>Date: ").concat(new Date(t.createdAt).toLocaleDateString(),'</div>\n      </div>\n       <div style="border-bottom: 1px dotted #000; margin-top: 10px; margin-bottom: 10px;"></div>\n      <div style="margin-bottom: 10px; font-weight: bold; font-size: 12px;">\n        <div style="display: flex; justify-content: space-between; text-align: center;">\n          <span style="flex: 1; text-align: left;">Item Name</span>\n          <span style="flex: 1;">Qty</span>\n          <span style="flex: 1;">Price</span>\n          <span style="flex: 1;text-align: right;">Total</span>\n        </div>\n      </div>\n      <div style="border-bottom: 1px dotted #000; margin-bottom: 10px;"></div>\n      ').concat(t.orderItems.map(e=>' \n        <div style="display: flex; justify-content: space-between; text-align: center; font-size: 12px;">\n          <span style="flex: 1; text-align: left;">'.concat(e.name,'</span>\n          <span style="flex: 1;">').concat(e.quantity,'</span>\n          <span style="flex: 1;">₹').concat(e.price.toFixed(2),'</span>\n          <span style="flex: 1;text-align: right;">₹').concat((e.price*e.quantity).toFixed(2),"</span>\n        </div>")).join(""),'\n      <div style="border-bottom: 1px dotted #000; margin-top: 10px; margin-bottom: 10px;"></div>\n      <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 14px;">\n       <span>Total Price:</span>\n      <span>₹\n      ').concat(t.totalPrice,'\n      </span>\n      </div>\n       <div style="border-bottom: 1px dotted #000; margin-top: 10px; margin-bottom: 10px;"></div>\n      <div style="display: flex; justify-content: space-between; font-size: 12px;">\n        <span>Item Discount:</span>\n        <span>-₹').concat(t.orderItems.reduce((e,t)=>e+t.price*t.quantity*t.discount/100,0).toFixed(2),"</span>\n      </div>\n      \n      ").concat(i>0?'\n      <div style="display: flex; justify-content: space-between; font-size: 12px;">\n        <span>Extra Discount:</span>\n        <span>-₹'.concat(((t.totalPrice-m)*i/100).toFixed(2),"</span>\n      </div>"):"",'\n\n      <div style="display: flex; justify-content: space-between; font-size: 12px;">\n        <span>Total GST:</span>\n          <span>+₹').concat(t.orderItems.reduce((e,t)=>{let a=t.price*t.quantity;return e+(a-a*t.discount/100)*t.gstRate/100},0).toFixed(2),'</span>\n      </div>\n     \n      <div style="border-bottom: 1px dotted #000; margin-top: 10px; margin-bottom: 10px;"></div>\n     \n     \n      <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 14px;">\n        <span>Final Price:</span>\n<span>₹').concat((t.totalPrice-t.orderItems.reduce((e,t)=>t.price*t.quantity*t.discount/100,0)+t.orderItems.reduce((e,t)=>{let a=t.price*t.quantity;return e+(a-a*t.discount/100)*t.gstRate/100},0)-(i>0?(t.totalPrice-m)*i/100:0)).toFixed(2),'</span>\n      </div>\n      \n      <div style="display: flex; align-items: center; font-weight: bold; font-size: 14px; margin-top: 10px; margin-bottom: 20px;">\n        <div style="flex: 1; border-top: 1px dotted #000;"></div>\n        <div style="padding: 0 10px; text-align: center;">\n        HAVE A NICE DAY\n        </div>\n        <div style="flex: 1; border-top: 1px dotted #000;"></div>\n      </div>\n    </div>\n    '),a=window.open("width=350,height=600");a.document.write('<!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Bill</title>\n    </head>\n    <body>\n      '.concat(e,"\n    </body>\n    </html>")),a.document.close(),a.print()};return(0,n.jsx)("div",{className:"popup-overlay1",children:(0,n.jsxs)("div",{className:"popup-content1",children:[(0,n.jsxs)("div",{className:"popup-header1",children:[(0,n.jsx)("h2",{children:"Restaurant Table Order"}),(0,n.jsx)("button",{className:"close-btn",onClick:a,children:"\xd7"})]}),(0,n.jsxs)("div",{className:"details-row",children:[(0,n.jsxs)("div",{className:"details-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"Customer Name:"}),(0,n.jsxs)("span",{className:"customer-name",children:[" ",t.customerName]})]}),(0,n.jsxs)("div",{className:"details-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"Table Number:"}),(0,n.jsxs)("span",{className:"customer-name",children:[" ",t.tableNumber]})]})]}),(0,n.jsxs)("div",{className:"details-row",children:[(0,n.jsxs)("div",{className:"details-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"Bill Amount:"}),(0,n.jsxs)("span",{className:"customer-name",children:[" ₹",r.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"details-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"Bill Date:"}),(0,n.jsxs)("span",{className:"customer-name",children:[new Date(t.createdAt).toLocaleDateString()," ",new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),(0,n.jsxs)("div",{className:"food-items",children:[(0,n.jsx)("h3",{className:"center-title",children:"Ordered Food"}),(0,n.jsxs)("table",{className:"food-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"S.No"}),(0,n.jsx)("th",{children:"Item Name"}),(0,n.jsx)("th",{children:"Quantity"}),(0,n.jsx)("th",{children:"Price (₹)"})]})}),(0,n.jsx)("tbody",{children:t.orderItems.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:e.name}),(0,n.jsx)("td",{children:e.quantity}),(0,n.jsx)("td",{children:(e.price*e.quantity).toFixed(2)})]},e.itemId))})]})]}),(0,n.jsxs)("div",{className:"extra-section",children:[(0,n.jsxs)("div",{className:"extra-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"Total Price:"}),(0,n.jsxs)("span",{className:"customer-name",children:[" ₹",t.totalPrice.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"extra-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"Discount:"}),(0,n.jsxs)("span",{className:"customer-name",children:[" -₹",m.toFixed(2)]})]}),(0,n.jsx)("div",{className:"extra-item extra-discount",children:(0,n.jsx)("input",{type:"number",className:"discount-input",placeholder:"Enter Extra Discount (%)",value:i||"",onChange:e=>l(Number(e.target.value)||0),style:{width:"150px"}})}),(0,n.jsxs)("div",{className:"extra-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"Extra Discount:"}),(0,n.jsxs)("span",{className:"customer-name",children:["-₹",((t.totalPrice-m)*i/100).toFixed(2)]})]}),(0,n.jsxs)("div",{className:"extra-item",children:[(0,n.jsx)("strong",{className:"customer-name1",children:"GST:"}),(0,n.jsxs)("span",{className:"customer-name",children:[" +₹",p.toFixed(2)]})]})]}),(0,n.jsxs)("div",{className:"popup-footer",children:[(0,n.jsx)("button",{className:"print-btn",onClick:u,children:"Print Bill"}),(0,n.jsxs)("div",{className:"final-total",children:[(0,n.jsx)("strong",{children:"Final Total:"})," ₹",r.toFixed(2)]})]})]})})},p=a(41192),u=()=>{let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[r,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[x,h]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/findtables"),a=await e.json();e.ok?t(a):d(a.message||"Something went wrong")}catch(e){d("Failed to fetch data")}finally{l(!1)}})()},[]);let j=async(a,n,s)=>{var l;let r=null===(l=e.find(e=>e._id===a))||void 0===l?void 0:l.status;try{t(e=>e.map(e=>e._id===a?{...e,status:s}:e));let e=await fetch("/api/orderstatus",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:n,status:s})});if(!e.ok)throw Error("Failed to update status in the database.");let l=await e.json();console.log("Updated table data:",l),i.Am.success("Table status updated successfully!",{position:"top-right",autoClose:3e3})}catch(e){console.error("Error updating table status:",e),t(e=>e.map(e=>e._id===a?{...e,status:r}:e)),i.Am.error("Failed to update table status. Please try again.",{position:"top-right",autoClose:3e3})}},g=e=>{let t=new Date(e);return"".concat(t.toLocaleDateString()," ").concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))},y=e=>{u(e),h(!0)},f=e=>{u(e),b(!0)};return a?(0,n.jsx)("div",{className:"loading",children:"Loading..."}):r?(0,n.jsx)("div",{className:"error",children:r}):(0,n.jsxs)("div",{className:"table-container1",children:[(0,n.jsxs)("div",{className:"table-header1",children:[(0,n.jsx)("div",{children:"S.No"}),(0,n.jsx)("div",{children:"Customer Name"}),(0,n.jsx)("div",{children:"Table Name"}),(0,n.jsx)("div",{children:"Bill Date"}),(0,n.jsx)("div",{children:"Bill Amount (₹)"}),(0,n.jsx)("div",{children:"Status"}),(0,n.jsx)("div",{children:"Update"}),(0,n.jsx)("div",{children:"View Bills"})]}),(0,n.jsx)("div",{className:"table-body1",children:e.slice().reverse().map((t,a)=>(0,n.jsxs)("div",{className:"table-row1",children:[(0,n.jsx)("div",{children:e.length-a}),(0,n.jsx)("div",{children:t.customerName}),(0,n.jsx)("div",{children:t.tableNumber}),(0,n.jsx)("div",{children:g(t.createdAt)}),(0,n.jsx)("div",{children:t.totalPrice}),(0,n.jsx)("div",{children:"available"===t.status?(0,n.jsxs)("div",{className:"status-done",children:[(0,n.jsx)(p.FJM,{className:"done-icon"})," Done"]}):(0,n.jsxs)("select",{value:t.status,onChange:e=>j(t._id,t.tableNumber,e.target.value),className:"status-dropdown",children:[(0,n.jsx)("option",{value:"occupied",children:"Occupied"}),(0,n.jsx)("option",{value:"reserved",children:"Reserved"}),(0,n.jsx)("option",{value:"available",children:"Available"})]})}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{className:"btn edit-btn",onClick:()=>"available"!==t.status&&y(t),disabled:"available"===t.status,children:"Update"})}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{className:"btn view-btn",onClick:()=>f(t),children:"View Bills"})})]},t._id))}),x&&(0,n.jsx)(o,{table:c,onClose:()=>{h(!1)},onUpdate:e=>{console.log("updatedTable",e),t(t=>t.map(t=>t._id===e._id?{...t,...e}:t)),h(!1)}}),v&&(0,n.jsx)(m,{table:c,onClose:()=>{b(!1)}}),(0,n.jsx)(i.Ix,{position:"top-right",autoClose:3e3,hideProgressBar:!0})]})},x=e=>{let{selectedTable:t,totalSeats:a,onClose:l,onPlaceOrder:o}=e,[c,m]=(0,s.useState)(""),[p,u]=(0,s.useState)(""),[x,h]=(0,s.useState)(""),[v,b]=(0,s.useState)(""),[j,g]=(0,s.useState)(""),[y,f]=(0,s.useState)([]),[N,w]=(0,s.useState)([]),[S,C]=(0,s.useState)([]),[T,k]=(0,s.useState)(!1),[P,A]=(0,s.useState)(!1),[E,q]=(0,s.useState)(""),[F,I]=(0,s.useState)(""),[O,_]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/categories"),t=await e.json();w(t)}catch(e){console.error("Error fetching categories:",e)}})()},[]),(0,s.useEffect)(()=>{(async()=>{if(v)try{let e=await fetch("/api/itemtable?category=".concat(v)),t=await e.json();C(t)}catch(e){console.error("Error fetching items:",e)}})()},[v]);let D=(e,t)=>{f(a=>a.map((a,n)=>n===e?{...a,quantity:a.quantity+t,total:(a.quantity+t)*a.price}:a).filter(e=>e.quantity>0))},R=e=>{f(t=>t.filter((t,a)=>a!==e))},z=()=>y.reduce((e,t)=>e+t.total,0),V=async()=>{if(!c){k(!0);return}let e={customerName:c,mobileNumber:p,seatNumber:x,tableNumber:t,maxPax:a,orderItems:y,totalPrice:z()};try{A(!0);let a=await fetch("/api/savetable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await a.json();if(a.ok){let e=await fetch("/api/updatestatus1",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:t,status:"occupied"})}),a=await e.json();e.ok?(i.Am.success("Order added and table status updated successfully!",{autoClose:3e3}),B(),l(),o(n),m(""),u(""),h(""),f([])):i.Am.error(a.error||"Failed to update table status",{autoClose:3e3})}else i.Am.error(n.message||"Failed to place the order",{autoClose:3e3})}catch(e){console.error("Error placing order:",e),i.Am.error("An error occurred while placing the order",{autoClose:3e3})}finally{A(!1)}},B=()=>{let e=new Date,a=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear(),i=e.getHours(),l=String(e.getMinutes()).padStart(2,"0"),r=i>=12?"PM":"AM";i%=12,i=i?String(i).padStart(2,"0"):"12";let d="".concat(a,"/").concat(n,"/").concat(s),o="".concat(i,":").concat(l," ").concat(r),c='\n    <div style="font-family: Arial, sans-serif; font-size: 14px; padding: 0; line-height: 1.4; max-width: 300px; margin: 0 auto; margin-left:-6px; margin-right:10px;">\n      <h2 style="text-align: center; margin-bottom: 2px;">Tomato Restaurant</h2>\n     \n  \n    \n      <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: #333; font-weight: bold;">\n         <div>\n      Kitchen Slip\n    </div>\n        <div>Table: '.concat(t,'</div>\n     \n\n\n      </div>\n      <div style="display: flex; justify-content: space-between; font-size: 12px;">\n    <div>Date: ').concat(d,"</div>\n        <div>Time: ").concat(o,'</div>\n    </div>\n    \n  \n      <div style="border-bottom: 1px dotted #000; margin-bottom: 10px;"></div>\n  \n      <div style="font-weight: bold; font-size: 12px;">\n        <div style="display: flex; justify-content: space-between; text-align: center;">\n          <span style="flex: 1; text-align: left;">Item Name</span>\n          <span style="flex: 1;text-align:right;">Qty</span>\n        </div>\n      </div>\n  \n      <div style="border-bottom: 1px dotted #000; margin-bottom: 10px;"></div>\n  \n      ').concat(y.map(e=>'\n            <div style="display: flex; justify-content: space-between; text-align: center; font-size: 12px;">\n              <span style="flex: 3; text-align: left;">'.concat(e.name,'</span>\n              <span style="flex: 1; text-align: right;">').concat(e.quantity,"</span>\n            </div>")).join(""),'\n          <div style="flex: 1; border-top: 1px dotted #000;margin-top: 7px;"></div>\n <div style="margin-bottom: 4px; margin-top: 8px;line-height: 1.6;">\n \n Note:   ').concat(F||"No remarks entered.",'\n </div>\n\n    <div style="flex: 1; border-top: 1px dotted #000;"></div>\n      <div style="display: flex; align-items: center; font-weight: bold; font-size: 14px; margin-top: 10px; margin-bottom: 20px;">\n        <div style="flex: 1; border-top: 1px dotted #000;"></div>\n        <div style="padding: 0 10px; text-align: center;">\n        Items Prepared Quickly\n        </div>\n        <div style="flex: 1; border-top: 1px dotted #000;"></div>\n      </div>\n\n\n    </div>\n  '),m=window.open("width=350,height=600");m.document.write('\n    <!DOCTYPE html>\n    <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Bill</title>\n      </head>\n      <body>\n        '.concat(c,"\n      </body>\n    </html>\n  ")),m.document.close(),m.print()};return(0,n.jsxs)("div",{className:"popup-overlay",children:[(0,n.jsxs)("div",{className:"popup-content",children:[(0,n.jsxs)("div",{className:"top-row",children:[(0,n.jsxs)("h2",{children:["Table No: ",t]}),(0,n.jsxs)("h2",{children:["Max Pax: ",a]})]}),(0,n.jsxs)("div",{className:"input-row",children:[(0,n.jsx)("input",{type:"text",placeholder:"Customer Name *",value:c,onChange:e=>m(e.target.value),className:T?"error":"",required:!0}),(0,n.jsx)("input",{type:"text",placeholder:"Mobile Number",value:p,onChange:e=>u(e.target.value)}),(0,n.jsx)("input",{type:"number",placeholder:"Pax",value:x,onChange:e=>h(e.target.value)})]}),(0,n.jsxs)("div",{className:"input-row",children:[(0,n.jsxs)("select",{value:v,onChange:e=>b(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Select Category"}),N.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e._id))]}),(0,n.jsxs)("select",{value:j,onChange:e=>g(e.target.value),disabled:!v,children:[(0,n.jsx)("option",{value:"",children:"Select Item"}),S.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e._id))]}),(0,n.jsx)("button",{onClick:()=>{if(!j)return;let e=S.find(e=>e.name===j);if(!e)return;let t=y.findIndex(t=>t.name===e.name);if(-1!==t)f(e=>e.map((e,a)=>a===t?{...e,quantity:e.quantity+1,total:(e.quantity+1)*e.price}:e));else{let t={name:e.name,price:e.price,quantity:1,total:e.price,itemId:e._id,discount:e.discount,gstRate:e.gstRate};f(e=>[...e,t])}g("")},children:"Add"})]}),(0,n.jsx)("div",{className:"order-items-container",children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"S.No."}),(0,n.jsx)("th",{children:"Item Name"}),(0,n.jsx)("th",{children:"Quantity"}),(0,n.jsx)("th",{children:"Price"}),(0,n.jsx)("th",{children:"Total"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:y.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:e.name}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"order-incress",children:(0,n.jsxs)("div",{className:"quantity-order",children:[(0,n.jsx)("button",{onClick:()=>D(t,-1),children:"-"}),e.quantity,(0,n.jsx)("button",{onClick:()=>D(t,1),children:"+"})]})})}),(0,n.jsx)("td",{children:e.price}),(0,n.jsx)("td",{children:e.total}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{onClick:()=>R(t),className:"delete-button",children:(0,n.jsx)(r.G,{icon:d.NBC})})})]},t))})]})}),(0,n.jsxs)("div",{className:"bottom-row",children:[(0,n.jsx)("button",{onClick:l,children:"Close"}),(0,n.jsx)("button",{onClick:()=>{_(!0)},children:"Remark"}),(0,n.jsx)("button",{onClick:V,disabled:P,children:P?"Placing Order...":"Place Order (₹".concat(z(),")")})]}),O&&(0,n.jsx)("div",{className:"popup-remake",children:(0,n.jsxs)("div",{className:"popup-content-remake",children:[(0,n.jsx)("div",{className:"popup-header-remake",children:(0,n.jsx)("h3",{children:"Remark"})}),(0,n.jsxs)("div",{className:"popup-body-remake",children:[(0,n.jsx)("label",{htmlFor:"description",children:"Note:"}),(0,n.jsx)("textarea",{id:"description",value:F,onChange:e=>I(e.target.value),placeholder:"Enter your remark here",rows:5,style:{width:"100%",padding:"8px",fontSize:"14px",border:"1px solid #ccc",borderRadius:"4px"}})]}),(0,n.jsxs)("div",{className:"popup-footer-remake",children:[(0,n.jsx)("button",{onClick:()=>{_(!1)},children:"Close"}),(0,n.jsx)("button",{onClick:()=>{console.log("Remark Saved:",F),_(!1)},children:"Save"})]})]})})]}),(0,n.jsx)(i.Ix,{})]})};a(57361);var h=e=>{let{onTableSelect:t}=e,[a,i]=(0,s.useState)(null),[l,o]=(0,s.useState)([]),[c,m]=(0,s.useState)(!0),[p,u]=(0,s.useState)(null),x=async()=>{try{let e=await fetch("/api/tablesview");if(!e.ok)throw Error("Failed to fetch tables");let t=await e.json();o(t.tables)}catch(e){u(e.message)}finally{m(!1)}};(0,s.useEffect)(()=>{x()},[]);let h=(e,n,s)=>{if("available"===s){let s=a===e?null:e;i(s),t(s,n)}};return c?(0,n.jsx)("div",{className:"loading",children:"Loading..."}):p?(0,n.jsx)("div",{className:"error",children:p}):(0,n.jsx)("div",{className:"table-container",children:(0,n.jsx)("div",{className:"table-row-order",children:l.map(e=>(0,n.jsxs)("div",{className:"table-item-order \n              ".concat(a===e.tableName?"selected":""," \n              ").concat("occupied"===e.status?"occupied":"","\n              ").concat("reserved"===e.status?"reserved":"","\n              ").concat("available"===e.status?"available":""),onClick:()=>h(e.tableName,e.seatNumber,e.status),children:[(0,n.jsx)("span",{className:"table-label",children:e.tableName}),(0,n.jsx)(r.G,{icon:d.NdV,className:"people-icon \n                ".concat(a===e.tableName?"selected-icon":"","\n                ").concat("occupied"===e.status?"occupied-icon":"","\n                ").concat("reserved"===e.status?"reserved-icon":"","\n                ").concat("available"===e.status?"available-icon":"")})]},e._id))})})};a(65949);var v=()=>{let[e,t]=(0,s.useState)("ViewTable"),[a,i]=(0,s.useState)(!1),[r,d]=(0,s.useState)(null),[o,c]=(0,s.useState)(0),m=e=>{if("AddTableOrder"===e){if(!r){alert("Please select a table first"),i(!0);return}i(!0)}else i(!1);t(e)};return(0,n.jsxs)("div",{className:"table-container",children:[(0,n.jsxs)("div",{className:"table-row ".concat(a?"blurred":""),children:[(0,n.jsx)("div",{className:"table-item ".concat("AddTable"===e?"active":""),onClick:()=>m("AddTable"),children:(0,n.jsx)("div",{className:"table-column",children:(0,n.jsxs)("div",{className:"column-box",children:[(0,n.jsx)("img",{src:"table8.webp",alt:"Add Table",className:"column-img"}),(0,n.jsx)("p",{className:"column-name",children:"Add Table"})]})})}),(0,n.jsx)("div",{className:"table-item ".concat("ViewTable"===e?"active":""),onClick:()=>m("ViewTable"),children:(0,n.jsx)("div",{className:"table-column",children:(0,n.jsxs)("div",{className:"column-box",children:[(0,n.jsx)("img",{src:"table1.png",alt:"View Table",className:"column-img"}),(0,n.jsx)("p",{className:"column-name",children:"View Table"})]})})}),(0,n.jsx)("div",{className:"table-item ".concat("AddTableOrder"===e?"active":""),onClick:()=>m("AddTableOrder"),children:(0,n.jsx)("div",{className:"table-column",children:(0,n.jsxs)("div",{className:"column-box",children:[(0,n.jsx)("img",{src:"table3.png",alt:"Add Table Order",className:"column-img"}),(0,n.jsx)("p",{className:"column-name",children:"Add Table Order"})]})})}),(0,n.jsx)("div",{className:"table-item ".concat("ViewTableOrder"===e?"active":""),onClick:()=>m("ViewTableOrder"),children:(0,n.jsx)("div",{className:"table-column",children:(0,n.jsxs)("div",{className:"column-box",children:[(0,n.jsx)("img",{src:"table2.png",alt:"View Table Order",className:"column-img"}),(0,n.jsx)("p",{className:"column-name",children:"View Table Orders"})]})})})]}),(0,n.jsx)("div",{className:"line-bottom"}),"ViewTable"===e&&(0,n.jsx)(h,{onTableSelect:(e,t)=>{d(e),c(t)}}),"AddTable"===e&&(0,n.jsx)(l,{}),a&&"AddTableOrder"===e&&(0,n.jsx)(x,{selectedTable:r,totalSeats:o,onClose:()=>{i(!1),d(null),t("ViewTable")}}),"ViewTableOrder"===e&&(0,n.jsx)(u,{})]})}}},function(e){e.O(0,[976,365,603,66,838,888,774,179],function(){return e(e.s=87291)}),_N_E=e.O()}]);